<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<meta name="description" content="">
<meta name="author" content="">


<title>Redblade: Redis 对象关系映射(ORM)和半自动索引工具</title>

<link href="css/bootstrap.min.css" rel="stylesheet">





<style>
body{
  padding-top: 70px;
  padding-bottom: 30px;
}
</style>


</head>

<body>




<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Redblade</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse pull-right">
      <ul class="nav navbar-nav">
        <li><a href="#">简介</a></li>
        <li><a href="#api">API</a></li>
      </ul>
    </div>
  </div>
</nav>










<div class="container theme-showcase" role="main">

<div class="jumbotron">
  <h2>Redblade 是一个Redis数据库对象关系映射(ORM)和索引工具</h2>
  <p class="lead">
  redis是目前最快的键值对内存数据库，一般用在需要应对超大规则并发应用和高速缓存的场合。
  但其无索引、无外键、无约束，查询不便，多数情况下和其它数据库搭配使用。redblade可以帮助你自动实现索引和数据查询；
  </p>
</div>


<div class="page-header">

</div>

<br><br>

<h3>安装</h3>
<p>你可以通过NPM安装， 同时它需要搭配node_redis驱动<code>npm install redis</code></p>
<pre>npm install redblade</pre>


<br><br>


<h3>初始化</h3>
<p>你需要先安装redis驱动</p>
<pre>
var client = require('redis').createClient();

//选一个空数据库
client.select(4);

var redblade = require('redblade');

//schema: 存放schema定义文件的路径，可以不填，并稍后加载
redblade.init({ schema:'/path/to/your/schema/folder',  client: client }, function(err) {

})
</pre>


<br><br>


<h3>定义schema</h3>
<p>这里定义了一个名为article的schema，并指定poster为索引字段（索引为无序集合），keywords为关键字字段（索引为有序集合，有两个参数，第二个参数为权重）</p>
<pre>
redblade.schema('article', {
    "_id"         : "id"
  , "poster"      : "index('user_article')"
  , "keywords"    : "keywords('articlekeys', return +new Date() / 60000 | 0)"
  , "title"       : "minlen(4)"
  , "content"     : "maxlen(6000)"
})
</pre>


<br><br>



<h3>插入一条article数据</h3>
<p>其中多余字段未在schema中定义，会被自动删除</p>
<pre>
redblade.insert('article', {
   _id         : '1234567890'
  , poster     : 'airjd'
  , keywords   : '信息技术,JavaScript,NoSQL'
  , title      : '测试用的SLIDE 标题'
  , content    : '测试用的SLIDE 内容'
  , '多余字段'   : '测试'
}, function(err) {

})
</pre>


<br><br>


<h3>查询数据</h3>
<p>根据schema中的索引查询此article：　注意，只有在schema中定义了 index 或 keywords索引的字段才能被查询，多个查询条件可以一起使用</p>
<pre>
redblade.select('article', { poster:'airjd' }, function(err, articles) {
  console.log(articles[0])
})

//or

redblade.select('article', { keywords: 'NoSQL' }, function(err, articles) {
  console.log(articles[0])
})
</pre>



<br><br>


<h3>原理是什么</h3>
<p>index：会自动根据插入的数据创建一个user_article:*的无序集合（因为无权重参数），　为1:N的关系，如需1:1可在schema中使用 unique('user_article')修饰</p>
<pre>
/*
set: "poster" : "index('user_article')" => user_article:[poster value]
*/
redblade.client.smembers('user_article:airjd', function (err, articleIDs) {
    console.log(articlesIDs)
})
</pre>

<p>keywords:会自动根据数据创建articleskeys无序集合和 articlekeys:* 的有序集合</p>
<pre>
/*
sorted set: "keywords" : "keywords('articlekeys', return +new Date() / 60000 | 0)"
*/
redblade.client.smembers('articlekeys', function(err, keys) {
    console.log(keys)
    //['信息技术','JavaScript','NoSQL']
})

redblade.client.zrange('articlekeys:NoSQL', 0, 100, function(err, articleIDs) {
    console.log(articleIDs)
    //["1234567890"]
})
</pre>



<br><br>


<h3>更新</h3>
<p>注意此函数被设计成当数据不存在时会在redis新建一条</p>
<pre>
redblade.update('article', {
   _id        : '1234567890'
  , content    : '更新了测试用的SLIDE 内容'
}, function(err) {

})
</pre>


<br><br>


<h3>删除</h3>
<p>你可以使用多个条件进行查询或删除</p>
<pre>
redblade.remove('article', { poster: 'airjd', keywords: 'SQL' }, function(err, num) {
    console.log(num)

    redblade.client.zrange('articlekeys:NoSQL', 0, 100, function(err, members) {
      //should be []
      console.log(members)
    })
})
</pre>


</div>




<br><br><br>


<div id="api" class="container">

<h1>API</h1>

<h2>Filter函数</h2>
<p>验证数据合法性，数据更新之前执行，不满足条件则不进行任何修改</p>
<blockquote>
int; max(maxNumber); min(minNumber); maxlen(maxNumber); minlen(minNumber); unique(schemaName)
</blockquote>


<h2>Commands函数</h2>
<p>相关性更新指令，数据更新之后执行，更新相关的索引等</p>
<blockquote>
index(indexSchema [, score]); keywords(keywordSchema [, score]); 
</blockquote>

<br><br><br>

<p>
注* 1) score支持以return开头的自定义函数  2) 字段方法只有在这些字段有值的时侯才触发
</p>


<br><br><br><br><br><br>



<div class="container">
  <hr>
  <footer>
    <p class="pull-right"><a href="#">Back to top</a></p>
    <p>
      源文件 <a href="https://github.com/newghost/redblade" target="_blank">Github</a>
    </p>
  </footer>
</div>


<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.js"></script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-43238430-2', 'ourjs.com');
ga('send', 'pageview');
</script>


  </body>
</html>
